최종 쿼리( 시간 점유율 API) 

 --일자별 통계 
 SELECT TO_CHAR(A.DT1,'YYYY/MM/DD') AS dates , B.CARGOALLTIMERATIO AS cargoTotal,C.CARGO1TIMERATIO AS cargoNo1 , D.CARGO2TIMERATIO AS cargoNo2
 FROM(SELECT TO_DATE('2023/10/17', 'YYYY/MM/DD') + (LEVEL - 1) AS DT1
 FROM DUAL 
 CONNECT BY LEVEL <= (TO_DATE('2023/11/26', 'YYYY/MM/DD') - TO_DATE('2023/10/17', 'YYYY/MM/DD')) + 1) A
 LEFT JOIN (SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGOALLDATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE ))*100,1)AS CARGOALLTIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD'))B
ON A.DT1 = B.CARGOALLDATE
LEFT JOIN(SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGO1DATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE WHERE CARGO_NO='1'))*100,1)AS CARGO1TIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01 AND CARGO_NO='1'
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD'))C
ON A.DT1 = C.CARGO1DATE
LEFT JOIN(SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGO2DATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE WHERE CARGO_NO='2'))*100,1)AS CARGO2TIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01 AND CARGO_NO='2'
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD')) D
ON A.DT1= D.CARGO2DATE
ORDER BY TO_CHAR(A.DT1,'YYYY/MM/DD') ASC;



--주차별 통계
SELECT MIN(A.DATES)||'~'||(MAX(A.DATES))AS DATES,NVL(ROUND(AVG(A.CARGOTOTAL)),0)AS CARGOTOTAL,ROUND(AVG(A.CARGONO1))AS CARGONO1,ROUND(AVG(A.CARGONO2))AS CARGONO2
FROM ( SELECT TO_CHAR(A.DT1,'YY/WW') AS WEEK , B.CARGOALLTIMERATIO AS cargoTotal,C.CARGO1TIMERATIO AS cargoNo1 , D.CARGO2TIMERATIO AS cargoNo2 ,TO_CHAR(A.DT1,'YYYY/MM/DD') AS dates
 FROM(SELECT TO_DATE('2023/10/17', 'YYYY/MM/DD') + (LEVEL - 1) AS DT1
 FROM DUAL 
 CONNECT BY LEVEL <= (TO_DATE('2023/11/26', 'YYYY/MM/DD') - TO_DATE('2023/10/17', 'YYYY/MM/DD')) + 1) A
 LEFT JOIN (SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGOALLDATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE ))*100,1)AS CARGOALLTIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD'))B
ON A.DT1 = B.CARGOALLDATE
LEFT JOIN(SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGO1DATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE WHERE CARGO_NO='1'))*100,1)AS CARGO1TIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01 AND CARGO_NO='1'
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD'))C
ON A.DT1 = C.CARGO1DATE
LEFT JOIN(SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGO2DATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE WHERE CARGO_NO='2'))*100,1)AS CARGO2TIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01 AND CARGO_NO='2'
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD')) D
ON A.DT1= D.CARGO2DATE
ORDER BY TO_CHAR(A.DT1,'YYYY/MM/DD') ASC)A
GROUP BY A.WEEK
ORDER BY A.WEEK ASC;


--월차별 통계
SELECT A.DATES AS DATES, ROUND(AVG(A.CARGOTOTAL))AS CARGOTOTAL,ROUND(AVG(A.CARGONO1)) AS CARGONO1,ROUND(AVG(A.CARGONO2)) AS CARGONO2
FROM(SELECT TO_CHAR(A.DT1,'YYYY/MM') AS dates , B.CARGOALLTIMERATIO AS cargoTotal,C.CARGO1TIMERATIO AS cargoNo1 , D.CARGO2TIMERATIO AS cargoNo2
 FROM(SELECT TO_DATE('2023/10/17', 'YYYY/MM/DD') + (LEVEL - 1) AS DT1
 FROM DUAL 
 CONNECT BY LEVEL <= (TO_DATE('2023/11/26', 'YYYY/MM/DD') - TO_DATE('2023/10/17', 'YYYY/MM/DD')) + 1) A
 LEFT JOIN (SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGOALLDATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE ))*100,1)AS CARGOALLTIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD'))B
ON A.DT1 = B.CARGOALLDATE
LEFT JOIN(SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGO1DATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE WHERE CARGO_NO='1'))*100,1)AS CARGO1TIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01 AND CARGO_NO='1'
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD'))C
ON A.DT1 = C.CARGO1DATE
LEFT JOIN(SELECT TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD') as CARGO2DATE ,ROUND((COUNT(DISTINCT SVC_TIME)/(SELECT COUNT( DISTINCT SVC_TIME) FROM GDM_SPOT_TYPE WHERE CARGO_NO='2'))*100,1)AS CARGO2TIMERATIO
FROM GDM_ORD_H H 
WHERE USE_YN='Y' AND STATUS !=01 AND CARGO_NO='2'
GROUP BY  TO_CHAR(H.frst_rgst_dt, 'YYYY/MM/DD')) D
ON A.DT1= D.CARGO2DATE
ORDER BY TO_CHAR(A.DT1,'YYYY/MM') ASC) A
GROUP BY A.DATES
ORDER BY A.DATES ASC




